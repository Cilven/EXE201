<div class=" mt-5">
    <h1 class="text-center mb-4">T·∫°o h·ªôp qu√† c·ªßa b·∫°n</h1>

    <ul class=" container nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link" id="step1-tab" data-bs-toggle="tab" href="/custom-gifts/gift">H∆∞·ªõng d·∫´n</a>
        </li>
        <li class="nav-item">
            <a class="nav-link " id="step1-tab" data-bs-toggle="tab" href="/custom-gifts">B∆∞·ªõc 1: Ch·ªçn s·∫£n ph·∫©m</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" id="step2-tab" data-bs-toggle="tab" href="">B∆∞·ªõc 2: Ch·ªçn H·ªôp qu√† t·∫∑ng</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="step3-tab" data-bs-toggle="tab" href="/custom-gifts/mes">B∆∞·ªõc 3: Th√™m tin nh·∫Øn c√°
                nh√¢n</a>
        </li>
    </ul>

    <div class="container tab-content">
        <!-- Tab 2 -->
        <div class="tab-pane fade show active" id="step2">
            <div class="row">
                <div class="col-md-6 product-container">
                    <h3>Ch·ªçn h·ªôp qu√† t·∫∑ng</h3>
                    {{#if boxs.length}}
                    {{#each boxs}}
                    <div class="product-card">
                        <img src="{{this.image}}" alt="{{this.name}}" class="gift-box-img">
                        <div class="product-description">
                            <p style="font-weight: bold;">{{this.name}}</p>
                            <p class="product-price">Gi√°:<span class="price-display"> {{this.price}}</span></p>
                            <label>
                                <input type="radio" name="giftBox" value="{{this.price}}"
                                    onchange="updateSelectedGiftBox('{{this.name}}','{{this.price}}')"> L·ª±a ch·ªçn
                            </label>
                        </div>
                    </div>
                    {{/each}}
                    {{else}}
                    <p>H·ªôp qu√† ƒëang h·∫øt trong kho</p>
                    {{/if}}
                </div>






                <div class="col-md-6">
                    <h3>H·ªôp qu√† ƒë√£ ch·ªçn</h3>
                    <div id="selected-gift-box" class="selected-summary">
                        <h5>Ch∆∞a c√≥ h·ªôp qu√† n√†o ƒë∆∞·ª£c ch·ªçn.</h5>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <a href="/custom-gifts">

                    <button class="btn btn-secondary next" onclick="goToStep(1)">B∆∞·ªõc tr∆∞·ªõc</button>

                </a>
                <a href="/custom-gifts/mes">

                    <button class="btn btn-primary next" onclick="goToStep(3)">B∆∞·ªõc ti·∫øp theo</button>

                </a>
            </div>
        </div>
    </div>
</div>


<script>


    // üè∑Ô∏è Chuy·ªÉn s·ªë th√†nh "299.000 VND"
    function formatCurrency(value) {
        return parseInt(value).toLocaleString("vi-VN") + " VND";
    }

    // üî¢ Chuy·ªÉn "299.000 VND" v·ªÅ s·ªë nguy√™n (299000) ƒë·ªÉ t√≠nh to√°n
    function parseCurrency(value) {
        return parseInt(value.replace(/[^\d]/g, "")); // Lo·∫°i b·ªè d·∫•u ch·∫•m v√† "VND"
    }

 




    // L∆∞u h·ªôp qu√† & radio v√†o sessionStorage
    function updateSelectedGiftBox(name, price, value) {
        const selectedGiftBoxDiv = document.getElementById("selected-gift-box");

        if (name) {
            selectedGiftBoxDiv.innerHTML = `<p>${name} - Gi√°: ${(price)}</p>`;
            saveGiftBoxToSessionStorage(name, price);
            saveSelectedRadio(value);
        } else {
            selectedGiftBoxDiv.innerHTML = '<h5>Ch∆∞a c√≥ h·ªôp qu√† n√†o ƒë∆∞·ª£c ch·ªçn.</h5>';
            sessionStorage.removeItem("selectedGiftBox");
            sessionStorage.removeItem("selectedGiftBoxRadio");
        }
    }

    // L∆∞u h·ªôp qu√† v√†o sessionStorage
   function saveGiftBoxToSessionStorage(name, price, radioValue) {
    const selectedBox = { name, price, radioValue };
    sessionStorage.setItem("selectedGiftBox", JSON.stringify(selectedBox));
}

    // L∆∞u radio ƒë√£ ch·ªçn v√†o sessionStorage
   /* function saveSelectedRadio(value) {
        sessionStorage.setItem("selectedGiftBoxRadio", value);
    }*/

    // Khi t·∫£i l·∫°i trang -> Kh√¥i ph·ª•c d·ªØ li·ªáu
   window.addEventListener("DOMContentLoaded", () => {
    if (sessionStorage.getItem("selectedGiftBox")) {
        const storedGiftBox = JSON.parse(sessionStorage.getItem("selectedGiftBox"));
        updateSelectedGiftBox(storedGiftBox.name, storedGiftBox.price, storedGiftBox.radioValue);
    }

    // üîπ Kh√¥i ph·ª•c radio button ƒë√£ ch·ªçn
    const storedGiftBox = JSON.parse(sessionStorage.getItem("selectedGiftBox"));
    if (storedGiftBox && storedGiftBox.radioValue) {
        document.querySelectorAll('input[name="giftBox"]').forEach(radio => {
            if (radio.value === storedGiftBox.radioValue) {
                radio.checked = true;
            }
        });
    }
});

    // X√≥a d·ªØ li·ªáu khi r·ªùi kh·ªèi /custom-gifts
    document.querySelectorAll("a.nav-link").forEach(link => {
        link.addEventListener("click", (event) => {
            const href = event.target.getAttribute("href");
            if (href && !href.startsWith("/custom-gifts")) {
                 
                sessionStorage.removeItem("selectedGiftBox");
                /*sessionStorage.removeItem("selectedGiftBoxRadio");*/
            }
        });
    });

</script>